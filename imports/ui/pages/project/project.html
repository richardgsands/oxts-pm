<template name="App_project">

    {{#if Template.subscriptionsReady}}

        {{#with project}}
            <div class="page-header">
                <h1>{{code}}</h1>
                <h2>{{name}}</h2>
            </div>

            {{#if getRelatedProjects}}
            <div class="well">
                <h4>Related projects</h4>
                {{#each getRelatedProjects}}
                    <a href="{{pathFor 'App.project.code' code=this.code}}">
                        <span class="label label-default">{{this.code}}</span>
                    </a>
                {{/each}}
            </div>
            {{/if}}

        {{else}}
            <h1 class="page-header">New project</h1>
        {{/with}}

        <div class="btn-group" role="group" aria-label="...">

            {{#each navStates}}
                <a href="{{pathFor currentRouteName code=($or project.code 'new') query=($concat 'section=' query)}}">
                    <button type="button" class="btn btn-default margin-bottom" {{renderIf ($and ($neq query 'tor') ($not project) ) 'disabled'}}>{{label}}</button>
                </a>
            {{/each}}

        </div>

        {{> Template.dynamic template=subTemplate data=project }}

    {{else}}
        <div class="center-block margin-top">{{> spinner}}</div>
    {{/if}}

</template>